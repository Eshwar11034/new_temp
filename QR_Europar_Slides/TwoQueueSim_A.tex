\begin{frame}{Simulation: Execution \& Spawning}
  \begin{columns}[c,onlytextwidth]

    % ----- LEFT: Text that updates with each click -----
    \column{0.4\textwidth}
    \only<1>{
      \begin{alertblock}{Step 1: Initial Task}
        The system starts with \textbf{$T_{1,1}$} ready at the front of the Main Queue.
      \end{alertblock}
    }
    \only<2-3>{
      \begin{alertblock}{Step 2: Dequeue \& Execute}
        An available thread, \textbf{T1}, from the pool dequeues the task from the Main Queue.
      \end{alertblock}
    }
    \only<4->{
      \begin{alertblock}{Step 3: Enqueue Children}
        After executing the task, T1 enqueues the ready child tasks (with dependencies satisfied) $T_{1,2}, \dots$ to the Main Queue.
      \end{alertblock}
    }

    % ----- RIGHT: The diagram with polished, non-overlapping arrows -----
    \column{0.6\textwidth}
    \centering
    \begin{tikzpicture}[font=\scriptsize, every node/.style={transform shape}, scale=0.95]
      % Styles
      \tikzset{pool/.style={draw, thick, ellipse, fill=accent!15, minimum width=2.8cm, minimum height=2cm}}
      \tikzset{thread_icon/.style={draw, circle, fill=accent!30, minimum size=0.5cm}}
      \tikzset{active_thread/.style={thread_icon, fill=accent!60, text=white, minimum size=0.6cm}}
      \tikzset{task_ready/.style={draw, rectangle, rounded corners=1pt, fill=updategreen!70, minimum width=1cm, minimum height=0.6cm}}
      \tikzset{queue_box/.style={draw, thick, fill=gray!10}}
      
      % --- Layout Elements ---
      \node[pool] (pool) at (3.5, 0) {};
      \node[anchor=north] at (pool.south) {Thread Pool};
      \node[anchor=south] at (-0.5, 2.5) {Main Queue};
      \draw[queue_box] (-3, 1.8) rectangle (2, 2.4);
      \node[font=\tiny] at (-2.8, 1.5) {(Front)};
      \node[font=\tiny] at (2, 1.5) {(Rear)};
      \node[anchor=south] at (-0.5, -1.5) {Wait Queue};
      \draw[queue_box] (-3, -2.2) rectangle (2, -1.6);
      \node[font=\tiny] at (-3, -2.5) {(Front)};
      \node[font=\tiny] at (2, -2.5) {(Rear)};
      
      % --- Idle Threads in the Pool ---
      \node<1,4->[thread_icon] at ($(pool.center)+(-0.8,0.2)$) {\tiny T1}; 
      \node[thread_icon] at ($(pool.center)+(0,0.5)$) {\tiny T2};
      \node[thread_icon] at ($(pool.center)+(0.8,0.2)$) {\tiny T3};
      
      % --- ANIMATION SEQUENCE ---
      
      % 1. Initial State
      \node<1>[task_ready] at (-2.5, 2.1) {$T_{1,1}$};
      
      % 2. T1 moves out of the pool
      \node<2-3>[active_thread] (active_t1) at (-0.5, -0.5) {\tiny T1};
      \draw<2>[-{Stealth}, thick] ($(pool.center)+(-1,0)$) to[bend right] (active_t1);
      
      % 3. T1 dequeues the task
      \node<2>[task_ready] at (-2.5, 2.1) {$T_{1,1}$};
      \node<3->[task_ready, right=1mm of active_t1] (task_t11) {$T_{1,1}$};
      % --- FIX 1: Increased bend to arc over the "(Front)" text ---
      \draw<3>[-{Stealth}, thick] (-3, 2.0) to[bend right=90] node[midway, left] {Dequeue} (active_t1);
      
      % 4. T1 enqueues the children
      % The new tasks appear at the Rear
      \node<4->[task_ready] at (1.5, 2.1) (t15) {$T_{1,5}$};
      \node<4->[task_ready] at (0.5, 2.1)  {$T_{1,4}$};
      \node<4->[task_ready] at (-0.4, 2.1) {$T_{1,3}$};
      \node<4->[task_ready] at (-1.3, 2.1) {$T_{1,2}$};
      % --- FIX 2: Draw the arrow AFTER the tasks so it appears on top ---
      \draw<4>[dashed, -{Stealth}, thick] (task_t11) to[bend right=60] node[midway, left] {Enqueue} (t15.north east);

    \end{tikzpicture}
  \end{columns}
\end{frame}