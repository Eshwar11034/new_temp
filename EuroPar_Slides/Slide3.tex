% Slide 3 â€” Where QR Lives in SLSQP
\begin{frame}{Where QR Lives in SLSQP}
  \begin{columns}[T,onlytextwidth]

    % ---- Left: key points ----
    \column{0.55\textwidth}
    \begin{tightitem}
      \item SLSQP solves a sequence of quadratic subproblems with linearized constraints.
      \item Each iteration computes a descent direction from a KKT-like system.
      \item Implementation relies on \textbf{in-place Householder QR}:
            \begin{tightitem}
              \item keeps $R$ in the upper triangle,
              \item stores reflectors $u$ in the lower triangle,
              \item keeps scalars $b[i]$ alongside.
            \end{tightitem}
      \item \textbf{Why in-place matters here:} the intermediate reflectors
            \((u,b)\) are \emph{consumed immediately} in the SLSQP iteration,
            not just the final $(Q,R)$.
    \end{tightitem}

    % ---- Right: SLSQP pipeline diagram ----
    \column{0.45\textwidth}
    \centering
    \begin{tikzpicture}[font=\small, node distance=5mm,
                        every node/.style={transform shape},
                        scale=0.8]
      % styles
      \tikzstyle{box}=[rectangle,rounded corners,draw,align=center,
                       inner sep=4pt,minimum width=3.6cm,fill=gray!10]
      \tikzstyle{qrbox}=[box,fill=pivotblue!12,very thick]
      \tikzstyle{cond}=[diamond,aspect=2,draw,align=center,inner sep=1pt,fill=gray!10]

      % nodes
      \node[box]   (init) {Initialize $x_0$};
      \node[box,below=of init] (lin)  {Linearize constraints};
      \node[box,below=of lin]  (kkt)  {Form subproblem / KKT};
      \node[qrbox,below=of kkt](qr)   {\textbf{In-place Householder QR}\\
                                       \footnotesize (emit reflectors $u$ and scalars $b[i]$)};
      \node[box,below=of qr]   (dir)  {Compute descent direction};
      \node[box,below=of dir]  (upd)  {Update $x$};
      \node[cond,below=of upd] (chk)  {Converged?};

      % arrows
      \draw[-{Stealth}] (init) -- (lin);
      \draw[-{Stealth}] (lin)  -- (kkt);
      \draw[-{Stealth}] (kkt)  -- (qr);
      \draw[-{Stealth}] (qr)   -- (dir);
      \draw[-{Stealth}] (dir)  -- (upd);
      \draw[-{Stealth}] (upd)  -- (chk);

      % loop-back arrow
      \draw[-{Stealth}] (chk.east) .. controls +(1.6,1.2) and +(1.6,-1.2) .. (lin.east);

      % yes/no labels (small)
      \node[anchor=west] at ($(chk.east)!0.55!(lin.east)+(1.5,0.0)$) {\scriptsize No};
      \node[anchor=north] at (chk.south) {\scriptsize Yes $\Rightarrow$ stop};
    \end{tikzpicture}


  \end{columns}
\end{frame}
