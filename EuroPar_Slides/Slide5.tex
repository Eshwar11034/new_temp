% Slide 5 â€” Barrier Scheduling on the QR DAG (Baseline)
\begin{frame}{Barrier Scheduling on the QR DAG (Baseline)}
% --- FONT SIZE DECREASED FROM \small TO \footnotesize ---
\footnotesize
\begin{columns}[T,onlytextwidth]

  % ---------- LEFT ----------
  \column{0.35\textwidth}

  \begin{block}{Mechanics (per iteration $i$)}
    \begin{tightitem}
      \item \textbf{Phase A:} compute pivot task $T_{i,i}$ to form $(u_i,b_i)$ and write $R/u$ in-place.
      \item \textbf{Barrier 1:} ensure all workers see $(u_i,b_i)$.
      \item \textbf{Phase B:} apply $(u_i,b_i)$ to updates $T_{i,j}$ for all $j>i$.
      \item \textbf{Barrier 2:} finalize iteration $i$ before entering $i{+}1$.
    \end{tightitem}
  \end{block}

  % ---------- RIGHT ----------
  \column{0.60\textwidth}
    \begin{block}{What this preserves}
    \begin{tightitem}
      \item Dependency rule: $\mathrm{parents}(T_{i,j})=\{\,T_{i,i},\,T_{i-1,j}\,\}$ \;(ignore $T_{0,j}$).
      \item In-place contract for SLSQP: upper $\rightarrow R$, lower $\rightarrow u$, side array $\rightarrow b[i]$.
    \end{tightitem}
  \end{block}

\centering
  \begin{tikzpicture}[x=0.38cm,y=0.9cm,>=Stealth, every node/.style={font=\scriptsize}, scale=0.80 ]
    % Styles
    \tikzset{work/.style   ={fill=updategreen!70,draw=updategreen!50!black,rounded corners=1pt}}
    \tikzset{wait/.style   ={fill=gray!30,      draw=gray!60,            rounded corners=1pt}}
    \tikzset{resume/.style ={fill=updategreen!60,draw=updategreen!50!black,rounded corners=1pt}}
    \tikzset{barline/.style={draw=pivotblue,very thick}}
    \tikzset{bartext/.style={fill=none,text=pivotblue}}

    % Axes
    \draw[->] (0,0) -- (24,0);
    \draw[->] (0,0) -- (0,5);
    \node[anchor=west] at (24,-0.15) {Time};

    % Lane labels
    \node at (-0.9,4) {P1};
    \node at (-0.9,3) {P2};
    \node at (-0.9,2) {P3};
    \node at (-0.9,1) {P4};

    % Global (iteration) barrier (dotted vertical guide)
    \draw[densely dotted,thick] (16,0.3) -- (16,4.7);

    % P1 timeline
    \draw[work]   (3,3.7) rectangle node{Working} (10,4.3);
    \draw[barline](10,3.6) -- (10,4.4);  \node[bartext] at (10.9,4.55) {Barrier};
    \draw[wait]   (10,3.7) rectangle node{Waiting} (15,4.3);
    \draw[resume] (17,3.7) rectangle node{Resume}  (20,4.3);

    % P2 timeline
    \draw[work]   (3,2.7) rectangle node{Working} (6,3.3);
    \draw[barline](6,2.6) -- (6,3.4);   \node[bartext] at (6.8,3.55) {Barrier};
    \draw[wait]   (6,2.7) rectangle node{Waiting} (15,3.3);
    \draw[resume] (17,2.7) rectangle node{Resume}  (20,3.3);

    % P3 timeline
    \draw[work]   (3,1.7) rectangle node{Working} (15,2.3);
    \draw[barline](15,1.6) -- (15,2.4); \node[bartext] at (15.9,2.55) {Barrier};
    \draw[resume] (17,1.7) rectangle node{Resume}  (20,2.3);

    % P4 timeline
    \draw[work]   (3,0.7) rectangle node{Working} (8,1.3);
    \draw[barline](8,0.6) -- (8,1.4);   \node[bartext] at (8.8,1.55) {Barrier};
    \draw[wait]   (8,0.7) rectangle node{Waiting} (15,1.3);
    \draw[resume] (17,0.7) rectangle node{Resume}  (20,1.3);
  \end{tikzpicture}

  % --- FONT SIZE OF CAPTION DECREASED ---
  {\scriptsize Fast threads wait at the barrier; useful overlap is lost until all reach the sync point.}
\end{columns}
\end{frame}